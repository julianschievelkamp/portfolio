function B(n){return Array.from(new Set(n))}function v(n,e){const t=N();return t[n]=t[n]||e}function N(){const n="_vike";return globalThis[n]=globalThis[n]||{}}const l=new Proxy({},{get:(n,e)=>t=>e==="code"?`\`${t}\``:e==="string"?`'${t}'`:t}),E="0.4.228";let f;f??(f=W());function W(){return v("utils/assertSingleInstance.ts",{instances:[],alreadyLogged:new Set})}function p(){return f??(f=W()),f}const G="Client runtime of both Server Routing and Client Routing loaded https://vike.dev/client-runtimes-conflict",P="Client runtime loaded twice https://vike.dev/client-runtime-duplicated";function R(){const n=p();{const e=B(n.instances);h(e.length<=1,`vike@${l.bold(e[0])} and vike@${l.bold(e[1])} loaded which is highly discouraged, see ${l.underline("https://vike.dev/warning/version-mismatch")}`,{onlyOnce:!0,showStackTrace:!1})}n.checkSingleInstance&&n.instances.length>1&&h(!1,P,{onlyOnce:!0,showStackTrace:!0})}function X(n){const e=p();h(e.isClientRouting!==!1,G,{onlyOnce:!0,showStackTrace:!0}),h(e.isClientRouting===void 0,P,{onlyOnce:!0,showStackTrace:!0}),e.isClientRouting=!0,e.checkSingleInstance=!0,R()}function V(){p().instances.push(E),R()}function h(n,e,{onlyOnce:t,showStackTrace:r}){const i=p();if(n)return;const o=`[Vike][Warning] ${e}`;{const{alreadyLogged:c}=i,u=o;if(c.has(u))return;c.add(u)}console.warn(r?new Error(o):o)}function A(){return!(typeof process>"u"||!process.cwd||!process.versions||typeof process.versions.node>"u"||!process.release||process.release.name!=="node")}function b(n,e){const t=new Error(n);return A()&&(t.stack=H(t.stack,e)),t}function H(n,e){if(!n)return n;const t=z(n);let r=0;return t.filter(o=>o.includes(" (internal/")||o.includes(" (node:internal")?!1:r<e&&J(o)?(r++,!1):!0).join(`
`)}function J(n){return n.startsWith("    at ")}function z(n){return n.split(/\r?\n/)}function D(n){return typeof n=="object"&&n!==null}const s=v("utils/assert.ts",{alreadyLogged:new Set,logger(n,e){e==="info"?console.log(n):console.warn(n)},showStackTraceList:new WeakSet});V();const F="[vike]",U=`[vike@${E}]`,q="Bug",y=2;function Z(n,e){var c;if(n)return;const t=(()=>{if(!e)return null;const u=typeof e=="string"?e:JSON.stringify(e);return l.dim(`Debug info (for Vike maintainers; you can ignore this): ${u}`)})();let i=[`You stumbled upon a Vike bug. Go to ${l.underline("https://github.com/vikejs/vike/issues/new?template=bug.yml")} and copy-paste this error. A maintainer will fix the bug (usually within 24 hours).`,t].filter(Boolean).join(" ");i=d(i),i=w(i,q),i=g(i,!0);const o=b(i,y);throw(c=s.onBeforeLog)==null||c.call(s),o}function M(n,e,{showStackTrace:t,exitOnError:r}={}){var o;if(n)return;t=t||s.alwaysShowStackTrace,e=d(e),e=w(e,"Wrong Usage"),e=g(e);const i=b(e,y);if(t&&s.showStackTraceList.add(i),(o=s.onBeforeLog)==null||o.call(s),r)console.error(t?i:e),process.exit(1);else throw i}function K(n){return n=d(n),n=w(n,"Error"),n=g(n),b(n,y)}function Y(n,e,{onlyOnce:t,showStackTrace:r}){var i;if(!n){if(r=r||s.alwaysShowStackTrace,e=d(e),e=w(e,"Warning"),e=g(e),t){const{alreadyLogged:o}=s,c=t===!0?e:t;if(o.has(c))return;o.add(c)}if((i=s.onBeforeLog)==null||i.call(s),r){const o=b(e,y);s.showStackTraceList.add(o),s.logger(o,"warn")}else s.logger(e,"warn")}}function ee(n,e,{onlyOnce:t}){var r;e=d(e),e=g(e);{const{alreadyLogged:i}=s,o=e;if(i.has(o))return;i.add(o)}(r=s.onBeforeLog)==null||r.call(s),s.logger(e,"info")}function w(n,e){let t=`[${e}]`;const r=e==="Warning"?"yellow":"red";return t=l.bold(l[r](t)),`${t}${n}`}function d(n){return n.startsWith("[")?n:` ${n}`}function g(n,e=!1){return`${e?U:F}${n}`}function L(n){const e=n/1e3;if(e<120){const t=x(e);return`${t} second${C(t)}`}{const t=e/60,r=x(t);return`${r} minute${C(r)}`}}function x(n){let e=n.toFixed(1);return e.endsWith(".0")&&(e=e.slice(0,-2)),e}function C(n){return n==="1"?"":"s"}const k=v("utils/executeHook.ts",{userHookErrors:new WeakMap,pageContext:null});function ne(n,e,t){const{hookName:r,hookFilePath:i,hookTimeout:{error:o,warning:c}}=e;let u,T;const _=new Promise((a,I)=>{u=m=>{S(),a(m)},T=m=>{S(),I(m)}}),S=()=>{j&&clearTimeout(j),$&&clearTimeout($)},j=O(c)&&setTimeout(()=>{Y(!1,`The ${r}() hook defined by ${i} is slow: it's taking more than ${L(c)} (https://vike.dev/hooksTimeout)`,{onlyOnce:!1})},c),$=O(o)&&setTimeout(()=>{const a=K(`The ${r}() hook defined by ${i} timed out: it didn't finish after ${L(o)} (https://vike.dev/hooksTimeout)`);T(a)},o);return(async()=>{try{Q(t);const a=await n();u(a)}catch(a){D(a)&&k.userHookErrors.set(a,{hookName:r,hookFilePath:i}),T(a)}})(),_}function O(n){return!!n&&n!==1/0}function te(){return k.pageContext}function Q(n){k.pageContext=n,Promise.resolve().then(()=>{k.pageContext=null})}export{v as a,M as b,l as c,Y as d,Z as e,ne as f,te as g,K as h,D as i,ee as j,X as k,Q as p,B as u};
